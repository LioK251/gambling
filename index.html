<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ROYAL CASINO V3</title>
    <style>
        /* --- GLOBAL & THEME --- */
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Roboto+Mono:wght@500&display=swap');

        :root {
            --bg-dark: #0b0b0f;
            --bg-panel: #14141a;
            --gold: #ffcc00;
            --gold-glow: #ffcc0088;
            --green: #00ff66;
            --red: #ff3333;
            --blue: #00ccff;
            --purple: #9933ff;
            --text-main: #ffffff;
            --glass: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            background-color: var(--bg-dark);
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 204, 0, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(153, 51, 255, 0.05) 0%, transparent 20%);
            color: var(--text-main);
            font-family: 'Montserrat', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            min-height: 100vh;
            overflow-x: hidden;
            user-select: none;
        }

        /* --- UI COMPONENTS --- */
        
        /* –ü–ª–∞–≤–Ω–æ—Å—Ç—å –¥–ª—è –≤—Å–µ–≥–æ */
        .anim-fast { transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1); }
        .anim-slow { transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1); }

        /* Header */
        header {
            width: 100%;
            padding: 15px 20px;
            background: rgba(11, 11, 15, 0.9);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--gold);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky; top: 0; z-index: 100;
            box-shadow: 0 5px 30px rgba(0,0,0,0.5);
        }

        .logo {
            font-size: 1.4rem;
            font-weight: 900;
            background: linear-gradient(45deg, var(--gold), #fff, var(--gold));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .balance-pill {
            background: rgba(0, 255, 102, 0.1);
            border: 1px solid var(--green);
            color: var(--green);
            padding: 8px 16px;
            border-radius: 30px;
            font-family: 'Roboto Mono', monospace;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 0 10px rgba(0, 255, 102, 0.2);
            transition: transform 0.2s;
        }
        .balance-pill:active { transform: scale(0.95); }

        /* Navigation */
        nav {
            display: flex;
            gap: 8px;
            padding: 15px 10px;
            overflow-x: auto;
            width: 100%;
            max-width: 600px;
            justify-content: flex-start; /* scrollable on mobile */
            scrollbar-width: none;
        }
        nav::-webkit-scrollbar { display: none; }

        .nav-item {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            color: #888;
            padding: 10px 16px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 700;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s ease;
        }
        .nav-item:hover { background: #222; color: #fff; }
        .nav-item.active {
            background: var(--gold);
            color: #000;
            border-color: var(--gold);
            box-shadow: 0 0 15px var(--gold-glow);
            transform: translateY(-2px);
        }

        /* Game Container */
        .game-wrapper {
            flex: 1;
            width: 100%;
            max-width: 500px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .game-scene {
            display: none;
            width: 100%;
            animation: slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .game-scene.active { display: block; }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        /* Control Panel */
        .panel {
            background: var(--bg-panel);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        .bet-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            background: #000;
            padding: 5px;
            border-radius: 12px;
            border: 1px solid #333;
        }
        
        input[type="number"] {
            background: transparent;
            border: none;
            color: white;
            font-family: 'Roboto Mono', monospace;
            font-size: 1.2rem;
            width: 100px;
            text-align: center;
            outline: none;
        }

        button.action-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--green), #00cc52);
            color: #000;
            font-weight: 900;
            font-size: 1.1rem;
            padding: 18px;
            border: none;
            border-radius: 14px;
            cursor: pointer;
            text-transform: uppercase;
            box-shadow: 0 10px 20px rgba(0, 255, 102, 0.2);
            transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        button.action-btn:hover { transform: translateY(-3px) scale(1.02); box-shadow: 0 15px 30px rgba(0, 255, 102, 0.4); }
        button.action-btn:active { transform: translateY(2px) scale(0.98); }
        button.action-btn:disabled { filter: grayscale(1) opacity(0.5); transform: none; cursor: not-allowed; }

        button.cashout { background: linear-gradient(135deg, var(--gold), #ffaa00); box-shadow: 0 10px 20px rgba(255, 204, 0, 0.3); }

        /* === GAME SPECIFICS === */

        /* 1. SLOTS */
        .slots-frame {
            background: #000;
            border: 3px solid var(--gold);
            border-radius: 15px;
            padding: 15px;
            display: flex;
            justify-content: center;
            gap: 8px;
            box-shadow: inset 0 0 30px rgba(0,0,0,0.8), 0 0 20px rgba(255,204,0,0.2);
        }
        .reel-col {
            width: 85px; height: 110px;
            background: #f0f0f0;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.5);
        }
        .reel-tape {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            font-size: 3rem;
        }
        .blur-anim {
            animation: blurScroll 0.2s infinite linear;
            background: linear-gradient(to bottom, #ddd 0%, #fff 50%, #ddd 100%);
            color: transparent;
            text-shadow: 0 0 15px rgba(0,0,0,0.5);
        }
        @keyframes blurScroll { 0% { background-position: 0 0; } 100% { background-position: 0 100px; } }

        /* 2. MINES (3D FLIP) */
        .mines-grid {
            display: grid; grid-template-columns: repeat(5, 1fr); gap: 8px;
            perspective: 800px; /* For 3D flip */
        }
        .tile-wrapper {
            aspect-ratio: 1;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.4s;
            cursor: pointer;
        }
        .tile-wrapper.flipped { transform: rotateY(180deg); cursor: default; }
        .tile-front, .tile-back {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden;
            border-radius: 8px;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; font-weight: bold;
        }
        .tile-front { background: #2a2a35; border-bottom: 4px solid #1a1a20; transition: background 0.2s; }
        .tile-front:hover { background: #3a3a45; }
        .tile-back { transform: rotateY(180deg); background: #111; box-shadow: inset 0 0 10px #000; }
        .tile-back.gem { background: rgba(0,255,102,0.1); border: 2px solid var(--green); text-shadow: 0 0 10px var(--green); }
        .tile-back.boom { background: rgba(255,51,51,0.2); border: 2px solid var(--red); }

        /* 3. STAIRS */
        .stairs-field { display: flex; flex-direction: column-reverse; gap: 6px; }
        .s-row { display: flex; gap: 8px; justify-content: center; opacity: 0.3; transition: 0.3s; }
        .s-row.active { opacity: 1; transform: scale(1.02); }
        .s-btn {
            flex: 1; height: 40px; background: #2a2a35;
            border: 1px solid #444; border-radius: 6px;
            cursor: pointer; transition: 0.2s; display: flex; align-items: center; justify-content: center;
        }
        .s-btn:hover { background: #3a3a45; }
        .s-btn.win { background: var(--green); color: #000; box-shadow: 0 0 15px var(--green); border-color: transparent; }
        .s-btn.lose { background: var(--red); opacity: 0.8; }

        /* 4. ROCKET */
        .rocket-area {
            height: 220px; background: linear-gradient(to bottom, #0b0b0f, #1a1a2e);
            border: 1px solid #333; border-radius: 15px;
            position: relative; overflow: hidden;
        }
        .rocket-ship {
            font-size: 40px; position: absolute; bottom: 10px; left: 10px;
            transition: bottom 0.1s linear, left 0.1s linear; /* Smooth programmatic movement */
            z-index: 5; filter: drop-shadow(0 0 10px orange);
        }
        .rocket-val {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            font-size: 4rem; font-weight: 900; color: rgba(255,255,255,0.1);
            z-index: 1;
        }

        /* 5. PLINKO (HARDCORE) */
        .plinko-box {
            background: #0f0f13; border: 2px solid #333;
            border-radius: 15px; padding: 15px 5px;
            position: relative; overflow: hidden;
            display: flex; flex-direction: column; align-items: center;
        }
        .peg-layer { margin-bottom: 5px; position: relative; }
        .plinko-row { display: flex; justify-content: center; gap: 24px; margin-bottom: 18px; } /* Adjusted spacing */
        .peg {
            width: 6px; height: 6px; background: #fff; border-radius: 50%;
            box-shadow: 0 0 4px rgba(255,255,255,0.5);
        }
        .bucket-layer { display: flex; gap: 4px; justify-content: center; width: 100%; padding: 0 10px; }
        .bucket {
            flex: 1; height: 30px; border-radius: 4px;
            display: flex; align-items: center; justify-content: center;
            font-size: 0.65rem; font-weight: bold; color: #fff;
            position: relative; transition: transform 0.1s;
        }
        /* Gradient Colors for buckets: Red (Edge) -> Yellow -> Green/Blue (Center) -> Red */
        .bucket.hit { transform: scale(1.3) translateY(-5px); z-index: 10; filter: brightness(1.5); }
        
        .p-ball {
            width: 10px; height: 10px; background: var(--gold);
            border-radius: 50%; position: absolute; top: 0; left: 50%;
            transform: translate(-50%, -50%);
            box-shadow: 0 0 8px var(--gold);
            will-change: top, left;
            z-index: 20;
        }

        /* 6. WHEEL */
        .wheel-wrap { position: relative; width: 280px; height: 280px; margin: 0 auto; }
        .the-wheel {
            width: 100%; height: 100%; border-radius: 50%; border: 6px solid #222;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            transition: transform 5s cubic-bezier(0.1, 0.9, 0.2, 1);
        }
        .wheel-arrow {
            position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
            width: 30px; height: 40px; background: #fff;
            clip-path: polygon(50% 100%, 0 0, 100% 0);
            z-index: 5; filter: drop-shadow(0 2px 2px rgba(0,0,0,0.5));
        }

        /* Color Buttons */
        .color-pick { display: flex; gap: 10px; margin-bottom: 15px; }
        .cp-btn {
            flex: 1; padding: 12px; border: 2px solid transparent; border-radius: 10px;
            font-weight: bold; cursor: pointer; color: white; transition: 0.2s;
        }
        .cp-btn.sel { border-color: #fff; transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        .cp-red { background: var(--red); }
        .cp-black { background: #333; }
        .cp-gold { background: var(--gold); color: black; }

    </style>
</head>
<body>

    <header>
        <div class="logo">ROYAL<span style="color:white">V3</span></div>
        <div class="balance-pill">
            <span>$</span><span id="balanceDisplay">0</span>
        </div>
    </header>

    <nav>
        <div class="nav-item active" onclick="setGame('slots', this)">üé∞ SLOTS</div>
        <div class="nav-item" onclick="setGame('mines', this)">üí£ MINES</div>
        <div class="nav-item" onclick="setGame('stairs', this)">ü™ú TOWER</div>
        <div class="nav-item" onclick="setGame('rocket', this)">üöÄ CRASH</div>
        <div class="nav-item" onclick="setGame('plinko', this)">üé± PLINKO</div>
        <div class="nav-item" onclick="setGame('wheel', this)">üé° WHEEL</div>
        <div class="nav-item" style="margin-left:auto; color: #555" onclick="resetGame()">‚ôªÔ∏è RESET</div>
    </nav>

    <div class="game-wrapper">

        <div id="g-slots" class="game-scene active">
            <div class="slots-frame">
                <div class="reel-col"><div class="reel-tape" id="r1">7</div></div>
                <div class="reel-col"><div class="reel-tape" id="r2">7</div></div>
                <div class="reel-col"><div class="reel-tape" id="r3">7</div></div>
            </div>
            <div class="panel">
                <div style="text-align: center; color: #888; margin-bottom: 10px; min-height: 24px;" id="slot-msg">–î–∂–µ–∫–ø–æ—Ç: x500</div>
                <button class="action-btn" id="btn-slots" onclick="spinSlots()">–ö–†–£–¢–ò–¢–¨ (50$)</button>
            </div>
        </div>

        <div id="g-mines" class="game-scene">
            <div class="mines-grid" id="mines-grid">
                </div>
            <div class="panel">
                <div class="bet-row">
                    <span style="color:#888; padding-left:10px;">–°—Ç–∞–≤–∫–∞</span>
                    <input type="number" id="mines-bet" value="100">
                </div>
                <div class="bet-row">
                    <span style="color:#888; padding-left:10px;">–ú–∏–Ω—ã (1-24)</span>
                    <input type="number" id="mines-count" value="3" max="24">
                </div>
                <div id="mines-status" style="text-align:center; margin-bottom:10px; color:#aaa;">–ò—â–µ–º –∞–ª–º–∞–∑—ã...</div>
                <button class="action-btn" id="btn-mines-start" onclick="startMines()">–ò–ì–†–ê–¢–¨</button>
                <button class="action-btn cashout" id="btn-mines-out" onclick="cashoutMines()" style="display:none">–ó–ê–ë–†–ê–¢–¨</button>
            </div>
        </div>

        <div id="g-stairs" class="game-scene">
            <div class="stairs-field" id="stairs-field">
                </div>
            <div class="panel">
                <div class="bet-row">
                    <span style="color:#888; padding-left:10px;">–°—Ç–∞–≤–∫–∞</span>
                    <input type="number" id="stairs-bet" value="100">
                </div>
                <button class="action-btn" id="btn-stairs-start" onclick="startStairs()">–ù–ê–ß–ê–¢–¨</button>
                <button class="action-btn cashout" id="btn-stairs-out" onclick="cashoutStairs()" style="display:none">–ó–ê–ë–†–ê–¢–¨</button>
            </div>
        </div>

        <div id="g-rocket" class="game-scene">
            <div class="rocket-area" id="rocket-area">
                <div class="rocket-val" id="rocket-txt">1.00x</div>
                <div class="rocket-ship" id="rocket-icon">üöÄ</div>
            </div>
            <div class="panel">
                <div class="bet-row">
                    <span style="color:#888; padding-left:10px;">–°—Ç–∞–≤–∫–∞</span>
                    <input type="number" id="rocket-bet" value="100">
                </div>
                <button class="action-btn" id="btn-rocket-start" onclick="startRocket()">–ó–ê–ü–£–°–ö</button>
                <button class="action-btn cashout" id="btn-rocket-out" onclick="cashoutRocket()" style="display:none">–ü–†–´–ì–ê–¢–¨</button>
            </div>
        </div>

        <div id="g-plinko" class="game-scene">
            <div class="plinko-box">
                <div id="p-balls-layer" style="position: absolute; top:0; left:0; width:100%; height:100%; pointer-events:none;"></div>
                <div id="p-pegs" class="peg-layer"></div>
                <div id="p-buckets" class="bucket-layer"></div>
            </div>
            <div class="panel">
                <div class="bet-row">
                    <span style="color:#888; padding-left:10px;">–°—Ç–∞–≤–∫–∞</span>
                    <input type="number" id="plinko-bet" value="50">
                </div>
                <button class="action-btn" id="btn-plinko" onclick="dropPlinko()" style="background: var(--blue); color:white;">–ë–†–û–°–ò–¢–¨ –®–ê–†</button>
            </div>
        </div>

        <div id="g-wheel" class="game-scene">
            <div class="wheel-wrap">
                <div class="wheel-arrow"></div>
                <div class="the-wheel" id="wheel-el"></div>
            </div>
            <div class="panel">
                <div class="color-pick">
                    <div class="cp-btn cp-red" onclick="pickWheelColor('red', this)">x2</div>
                    <div class="cp-btn cp-black" onclick="pickWheelColor('black', this)">x2</div>
                    <div class="cp-btn cp-gold" onclick="pickWheelColor('gold', this)">x14</div>
                </div>
                <div class="bet-row">
                    <span style="color:#888; padding-left:10px;">–°—Ç–∞–≤–∫–∞</span>
                    <input type="number" id="wheel-bet" value="100">
                </div>
                <button class="action-btn" id="btn-wheel" onclick="spinWheel()" disabled>–í–†–ê–©–ê–¢–¨</button>
            </div>
        </div>

    </div>

    <script>
        /* --- CORE SYSTEM --- */
        let balance = parseInt(localStorage.getItem('rv3_bal')) || 2500;
        const balEl = document.getElementById('balanceDisplay');
        
        function updateBal(amount) {
            let old = balance;
            balance += amount;
            balance = Math.floor(balance);
            localStorage.setItem('rv3_bal', balance);
            
            // Smooth counter
            let diff = balance - old;
            let steps = 20;
            let stepVal = diff / steps;
            let cur = old;
            let i = 0;
            let int = setInterval(() => {
                cur += stepVal;
                i++;
                balEl.innerText = Math.floor(cur);
                if(i >= steps) {
                    clearInterval(int);
                    balEl.innerText = balance;
                }
            }, 20);
        }
        balEl.innerText = balance;

        function resetGame() {
            if(confirm("–°–±—Ä–æ—Å–∏—Ç—å –±–∞–ª–∞–Ω—Å –¥–æ 2500$?")) {
                balance = 2500; updateBal(0); window.location.reload();
            }
        }

        function setGame(id, btn) {
            document.querySelectorAll('.game-scene').forEach(e => e.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
            document.getElementById('g-'+id).classList.add('active');
            if(btn) btn.classList.add('active');
        }

        /* --- 1. SLOTS (Motion Blur) --- */
        const syms = ['üçí','üçã','üçá','üíé','7Ô∏è‚É£','üîî'];
        function spinSlots() {
            if(balance < 50) return alert('–ú–∞–ª–æ –¥–µ–Ω–µ–≥');
            updateBal(-50);
            
            const btn = document.getElementById('btn-slots');
            btn.disabled = true;
            document.getElementById('slot-msg').innerText = "–í—Ä–∞—â–µ–Ω–∏–µ...";
            
            const reels = [document.getElementById('r1'), document.getElementById('r2'), document.getElementById('r3')];
            
            // Start Anim
            reels.forEach(r => {
                r.classList.add('blur-anim');
                r.innerText = ""; 
            });

            let res = [];
            // Stop logic with stagger
            [0,1,2].forEach(i => {
                setTimeout(() => {
                    reels[i].classList.remove('blur-anim');
                    let s = syms[Math.floor(Math.random()*syms.length)];
                    reels[i].innerText = s;
                    res.push(s);
                    // Bounce
                    reels[i].style.transform = "translateY(-10px)";
                    setTimeout(()=> reels[i].style.transform = "translateY(0)", 150);
                    
                    if(i===2) checkSlots(res, btn);
                }, 800 + (i*400));
            });
        }
        function checkSlots(res, btn) {
            let win = 0;
            if(res[0]==res[1] && res[1]==res[2]) {
                if(res[0]=='7Ô∏è‚É£') win=500; else win=100;
            } else if(res[0]==res[1] || res[1]==res[2]) win=10;
            
            if(win > 0) {
                updateBal(win*50); // mult base bet
                document.getElementById('slot-msg').innerText = `–í–´–ò–ì–†–´–®: ${win*50}$`;
                document.getElementById('slot-msg').style.color = "var(--green)";
            } else {
                document.getElementById('slot-msg').innerText = "–ü–æ–ø—Ä–æ–±—É–π –µ—â–µ";
                document.getElementById('slot-msg').style.color = "#888";
            }
            btn.disabled = false;
        }

        /* --- 2. MINES (3D Flip) --- */
        let mActive=false, mMap=[], mBet=0, mRev=0, mTot=3;
        function startMines() {
            if(mActive) return;
            let b = parseInt(document.getElementById('mines-bet').value);
            let c = parseInt(document.getElementById('mines-count').value);
            if(b>balance || b<=0) return;
            
            updateBal(-b); mBet=b; mTot=c; mRev=0; mActive=true;
            mMap = Array(25).fill(0);
            let placed=0;
            while(placed<c) { let k=Math.floor(Math.random()*25); if(!mMap[k]){ mMap[k]=1; placed++; }}

            const grid = document.getElementById('mines-grid');
            grid.innerHTML = "";
            for(let i=0; i<25; i++) {
                let w = document.createElement('div'); w.className = 'tile-wrapper';
                w.innerHTML = `<div class="tile-front"></div><div class="tile-back"></div>`;
                w.onclick = () => hitMine(i, w);
                grid.appendChild(w);
            }
            document.getElementById('btn-mines-start').style.display='none';
            document.getElementById('btn-mines-out').style.display='block';
            document.getElementById('mines-status').innerText = "–ò—â–µ–º...";
        }
        function hitMine(i, el) {
            if(!mActive || el.classList.contains('flipped')) return;
            el.classList.add('flipped');
            let back = el.querySelector('.tile-back');
            
            if(mMap[i]===1) {
                back.innerText = "üí£"; back.classList.add('boom');
                mActive=false;
                setTimeout(()=> revealAll(false), 500);
                document.getElementById('mines-status').innerText = "–í–ó–†–´–í!";
            } else {
                back.innerText = "üíé"; back.classList.add('gem');
                mRev++;
                let multi = 1; 
                for(let k=0; k<mRev; k++) multi *= (25-k)/(25-mTot-k);
                let win = Math.floor(mBet * multi);
                document.getElementById('btn-mines-out').innerText = `–ó–ê–ë–†–ê–¢–¨ ${win}$`;
            }
        }
        function cashoutMines() {
            if(!mActive) return;
            let multi = 1; for(let k=0; k<mRev; k++) multi *= (25-k)/(25-mTot-k);
            updateBal(Math.floor(mBet*multi));
            mActive=false; revealAll(true);
        }
        function revealAll(win) {
            document.getElementById('btn-mines-start').style.display='block';
            document.getElementById('btn-mines-out').style.display='none';
            let tiles = document.querySelectorAll('.tile-wrapper');
            tiles.forEach((t, i) => {
                if(mMap[i]===1) {
                    t.classList.add('flipped');
                    t.querySelector('.tile-back').innerText = "üí£";
                    if(win) t.style.opacity = 0.3;
                }
            });
        }

        /* --- 3. STAIRS (Standard) --- */
        let sActive=false, sLvl=0, sBet=0;
        function startStairs() {
            if(sActive) return;
            let b = parseInt(document.getElementById('stairs-bet').value);
            if(b>balance || b<=0) return;
            updateBal(-b); sBet=b; sLvl=0; sActive=true;
            
            const f = document.getElementById('stairs-field'); f.innerHTML="";
            for(let r=0; r<7; r++) {
                let row = document.createElement('div'); row.className = 's-row';
                if(r===0) row.classList.add('active');
                let bomb = Math.floor(Math.random()*3);
                for(let c=0; c<3; c++) {
                    let btn = document.createElement('div'); btn.className='s-btn'; btn.innerText='?';
                    btn.onclick = () => clickStair(r, c, bomb, btn, row);
                    row.appendChild(btn);
                }
                f.appendChild(row);
            }
            toggleStairsBtn(true);
        }
        function clickStair(r, c, bomb, btn, row) {
            if(!sActive || r!==sLvl) return;
            if(c===bomb) {
                btn.classList.add('lose'); btn.innerText='üóø';
                sActive=false; toggleStairsBtn(false);
            } else {
                btn.classList.add('win'); btn.innerText='üí∞';
                sLvl++;
                row.classList.remove('active');
                if(sLvl<7) {
                    document.querySelectorAll('.s-row')[sLvl].classList.add('active');
                    let win = Math.floor(sBet * Math.pow(1.5, sLvl));
                    document.getElementById('btn-stairs-out').innerText = `–ó–ê–ë–†–ê–¢–¨ ${win}$`;
                } else {
                    cashoutStairs();
                }
            }
        }
        function cashoutStairs() {
            if(!sActive) return;
            updateBal(Math.floor(sBet * Math.pow(1.5, sLvl)));
            sActive=false; toggleStairsBtn(false);
        }
        function toggleStairsBtn(ingame) {
            document.getElementById('btn-stairs-start').style.display = ingame ? 'none':'block';
            document.getElementById('btn-stairs-out').style.display = ingame ? 'block':'none';
        }

        /* --- 4. ROCKET (Smooth Loop) --- */
        let rFly=false, rInt, rMul=1.00;
        function startRocket() {
            if(rFly) return;
            let b = parseInt(document.getElementById('rocket-bet').value);
            if(b>balance || b<=0) return;
            updateBal(-b); rFly=true; rMul=1.00;
            
            document.getElementById('btn-rocket-start').style.display='none';
            document.getElementById('btn-rocket-out').style.display='block';
            document.getElementById('rocket-icon').innerText = 'üöÄ';
            document.getElementById('rocket-txt').style.color = "rgba(255,255,255,0.1)";

            let crash = 1.00 + Math.random() * Math.random() * 10; // Simple weighted curve
            if(Math.random()<0.3) crash = 1.00 + Math.random(); // 30% early crash

            let t=0;
            rInt = setInterval(() => {
                t+=0.05;
                rMul += t*0.01;
                document.getElementById('rocket-txt').innerText = rMul.toFixed(2)+'x';
                
                // Visuals
                let pct = Math.min((rMul-1)*20, 90);
                let ic = document.getElementById('rocket-icon');
                ic.style.bottom = (10 + pct) + '%';
                ic.style.left = (10 + pct/2) + '%';

                if(rMul >= crash) {
                    clearInterval(rInt); rFly=false;
                    document.getElementById('rocket-txt').style.color = "var(--red)";
                    document.getElementById('rocket-txt').innerText = "CRASH @ " + crash.toFixed(2)+'x';
                    document.getElementById('rocket-icon').innerText = 'üí•';
                    toggleRockBtn(false);
                }
            }, 50);
        }
        function cashoutRocket() {
            if(!rFly) return;
            clearInterval(rInt); rFly=false;
            let win = Math.floor(document.getElementById('rocket-bet').value * rMul);
            updateBal(win);
            document.getElementById('rocket-txt').style.color = "var(--green)";
            toggleRockBtn(false);
        }
        function toggleRockBtn(ingame) {
            document.getElementById('btn-rocket-start').style.display = ingame ? 'none':'block';
            document.getElementById('btn-rocket-out').style.display = ingame ? 'block':'none';
        }

        /* --- 5. PLINKO (HARDCORE & SMOOTH) --- */
        const rows = 12; // Harder
        const pegsEl = document.getElementById('p-pegs');
        const bucketsEl = document.getElementById('p-buckets');
        // Multipliers: Center is BAD (0.2), Edges GOOD (100)
        const mults = [100, 25, 5, 2, 0.5, 0.2, 0.2, 0.5, 2, 5, 25, 100]; 
        // Need mults.length = rows + 1? No, 12 rows means 13 slots. My array is 12 long.
        // Let's adjust to 12 rows -> 13 slots.
        const pValues = [100, 25, 10, 5, 2, 0.5, 0.2, 0.5, 2, 5, 10, 25, 100];

        // Init Board
        function initPlinko() {
            pegsEl.innerHTML=""; bucketsEl.innerHTML="";
            for(let r=0; r<rows; r++) {
                let row = document.createElement('div'); row.className='plinko-row';
                for(let p=0; p<=r+2; p++) {
                    let dot = document.createElement('div'); dot.className='peg';
                    row.appendChild(dot);
                }
                pegsEl.appendChild(row);
            }
            pValues.forEach(v => {
                let b = document.createElement('div'); b.className='bucket'; 
                b.innerText = v+'x';
                // Color coding
                if(v>=10) b.style.backgroundColor = "var(--red)";
                else if(v>=2) b.style.backgroundColor = "var(--gold)";
                else b.style.backgroundColor = "#333";
                bucketsEl.appendChild(b);
            });
        }
        initPlinko();

        function dropPlinko() {
            let b = parseInt(document.getElementById('plinko-bet').value);
            if(b>balance || b<=0) return;
            updateBal(-b);

            const ball = document.createElement('div'); ball.className='p-ball';
            document.getElementById('p-balls-layer').appendChild(ball);

            // Physics sim
            let currentRow = 0;
            let currentIdx = 0; // Relative from center? No, simpler to track index in row
            
            // Start pos: center of top row (width calc is tricky, let's use fixed steps)
            // Visual approximation logic:
            let startX = pegsEl.offsetWidth / 2;
            let startY = 10;
            let stepY = 24; // approx height of row + margin
            let stepX = 15; // approx half width of spread

            let x = startX; 
            let y = startY;

            let path = [];
            // Calculate Path (Pure 50/50 Math = Hard Center bias)
            for(let i=0; i<rows; i++) {
                let dir = Math.random() > 0.5 ? 1 : -1;
                path.push(dir);
            }

            // Animate
            let step = 0;
            function animateDrop() {
                if(step >= rows) {
                    // Finish
                    ball.remove();
                    // Calc result slot. Start 0 is center? 
                    // Let's count rights. 12 steps. 
                    // 0 rights = index 0. 12 rights = index 12.
                    let rights = path.filter(d => d === 1).length;
                    // Actually, the visual grid adds 1 peg per row.
                    // Start: 3 pegs. End: 15 pegs. 
                    // The ball falls between pegs. 13 slots.
                    // Standard plinko map: Slot = sum(rights)
                    let slotIdx = rights; 
                    
                    let m = pValues[slotIdx];
                    let win = Math.floor(b * m);
                    if(win>0) updateBal(win);
                    
                    // Visual Hit
                    let bucket = bucketsEl.children[slotIdx];
                    bucket.classList.add('hit');
                    setTimeout(() => bucket.classList.remove('hit'), 200);
                    return;
                }

                // Move ball
                y += stepY;
                x += (path[step] * stepX);
                
                ball.style.top = y + 'px';
                ball.style.left = x + 'px';
                
                step++;
                setTimeout(animateDrop, 80); // Speed
            }
            // Init Pos
            ball.style.top = y+'px'; ball.style.left=x+'px';
            setTimeout(animateDrop, 80);
        }

        /* --- 6. WHEEL (Smooth Spin) --- */
        let wSpin=false, wCol=null;
        const wSegs = ['gold','black','red','black','red','black','red','black','red','black','red','black','red','black','red'];
        // Generate CSS Conic
        let css = "conic-gradient(";
        let deg = 360/15;
        wSegs.forEach((c,i) => {
            let color = c=='gold'?'#ffd700':(c=='red'?'#cc0000':'#111');
            css += `${color} ${i*deg}deg ${(i+1)*deg}deg,`;
        });
        css = css.slice(0,-1)+")";
        document.getElementById('wheel-el').style.background = css;

        function pickWheelColor(c, el) {
            if(wSpin) return;
            wCol=c;
            document.querySelectorAll('.cp-btn').forEach(b=>b.classList.remove('sel'));
            el.classList.add('sel');
            document.getElementById('btn-wheel').disabled = false;
        }
        function spinWheel() {
            if(wSpin || !wCol) return;
            let b = parseInt(document.getElementById('wheel-bet').value);
            if(b>balance || b<=0) return;
            updateBal(-b); wSpin=true; document.getElementById('btn-wheel').disabled=true;

            let randIdx = Math.floor(Math.random()*15);
            let resColor = wSegs[randIdx];
            
            // Math for rotation to land on index
            // Index 0 is at 0-24deg (Top Right). Pointer is Top Center (0deg).
            // Rotation must be Counter-Clockwise to bring index to top? 
            // Or Clockwise negative.
            // Target Angle = 360 - (randIdx * 24 + 12); // Center of segment
            let segmentAngle = 24;
            let target = 360 - (randIdx * segmentAngle + segmentAngle/2);
            let spins = 360 * 5; // 5 full spins
            let finalRot = spins + target;

            const el = document.getElementById('wheel-el');
            el.style.transition = "transform 4s cubic-bezier(0.1, 0.9, 0.2, 1)";
            el.style.transform = `rotate(${finalRot}deg)`;

            setTimeout(() => {
                wSpin=false;
                el.style.transition = "none";
                el.style.transform = `rotate(${target}deg)`; // reset
                
                let win=0;
                if(resColor===wCol) {
                    let m = wCol==='gold'?14:2;
                    win = b*m;
                    updateBal(win);
                    alert(`WIN! ${win}$`);
                }
                document.getElementById('btn-wheel').disabled = false;
            }, 4000);
        }

    </script>
</body>
</html>
